
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BỘ ĐỀ ÔN IOE K3 SỐ: 02.1</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .word-block {
            user-select: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        audio {
            filter: sepia(20%) saturate(70%) grayscale(1) contrast(99%) brightness(90%);
        }
    </style>
</head>
<body class="bg-gray-50 font-sans antialiased text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        // --- DỮ LIỆU CÂU HỎI ---
        const questions = [
            {
                type: 'fill-in-the-blank',
                question: '1. What’s y__ur name?',
                correctAnswer: 'o',
                correctAnswer_vi: 'o (để hoàn thành "your")',
                hint_vi: 'Từ cần điền là một phần của từ có nghĩa là "của bạn" để hỏi tên.',
                rationale_vi: 'Từ đúng là "your" (của bạn). Câu hoàn chỉnh là: "What’s your name?" có nghĩa là "Tên của bạn là gì?".'
            },
            {
                type: 'multimedia',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206306167591442_Audio.mp3',
                question: '2. Let’s go to the school ________ .',
                correctAnswer: 'library',
                correctAnswer_vi: 'thư viện',
                hint_vi: 'Nơi trong trường có rất nhiều sách để đọc và mượn.',
                rationale_vi: 'Trong đoạn audio, người nói đề nghị đến thư viện. Câu hoàn chỉnh: "Let’s go to the school library." nghĩa là "Chúng ta hãy đến thư viện trường.".'
            },
            {
                type: 'fill-in-the-blank',
                question: '3. I draw a pictu__ in the room.',
                correctAnswer: 're',
                correctAnswer_vi: 're (để hoàn thành "picture")',
                hint_vi: 'Từ này có nghĩa là "bức tranh" trong tiếng Anh, hãy điền phần còn thiếu.',
                rationale_vi: 'Từ đúng là "picture" (bức tranh). Câu hoàn chỉnh: "I draw a picture in the room." nghĩa là "Tôi vẽ một bức tranh trong phòng.".'
            },
            {
                type: 'fill-in-the-blank',
                question: '4. __at is your name? - My name is Hung.',
                correctAnswer: 'Wh',
                correctAnswer_vi: 'Wh (để hoàn thành "What")',
                hint_vi: 'Đây là từ để hỏi "Cái gì?" trong câu hỏi về tên.',
                rationale_vi: 'Từ để hỏi về tên là "What". Câu hoàn chỉnh: "What is your name?" nghĩa là "Tên của bạn là gì?".'
            },
            {
                type: 'rearrange',
                question: '5. Sắp xếp các từ sau:',
                words: ["Open", "your book,", "please!"],
                correctAnswer: "Open your book, please!",
                correctAnswer_vi: 'Mở sách của bạn ra, làm ơn!',
                hint_vi: 'Đây là một câu mệnh lệnh lịch sự. Bắt đầu bằng động từ và kết thúc bằng "please!".',
                rationale_vi: 'Đây là câu mệnh lệnh. Cấu trúc đúng là: Động từ (Open) + tân ngữ (your book) + từ lịch sự (please). Câu hoàn chỉnh: "Open your book, please!" có nghĩa là "Làm ơn mở sách của bạn ra!".'
            },
            {
                type: 'mc',
                question: '6. May I ___ the book?',
                options: [ { text: 'A. open', isCorrect: true }, { text: 'B. stand', isCorrect: false }, { text: 'C. play', isCorrect: false }, { text: 'D. sit', isCorrect: false } ],
                correctAnswer: 'A. open',
                correctAnswer_vi: 'mở',
                hint_vi: 'Để xin phép làm gì đó với cuốn sách, bạn sẽ dùng động từ nào?',
                rationale_vi: 'Để xin phép, ta dùng cấu trúc "May I + động từ?". "Open the book" có nghĩa là "mở sách". Câu hoàn chỉnh: "May I open the book?" có nghĩa là "Tôi có thể mở sách ra không?".'
            },
            {
                type: 'mc',
                question: '7. That is a big tr...e.',
                options: [ { text: 'A. a', isCorrect: false }, { text: 'B. u', isCorrect: false }, { text: 'C. e', isCorrect: true }, { text: 'D. i', isCorrect: false } ],
                correctAnswer: 'C. e',
                correctAnswer_vi: 'e (để tạo thành "tree")',
                hint_vi: 'Từ này có nghĩa là "cái cây" và được đánh vần là T-R-E-E.',
                rationale_vi: 'Từ đúng là "tree" (cái cây). Câu hoàn chỉnh: "That is a big tree." có nghĩa là "Đó là một cái cây to.".'
            },
            {
                type: 'mc',
                question: '8. _______ fine, thanks.',
                options: [ { text: 'A. I am', isCorrect: true }, { text: 'B. I', isCorrect: false }, { text: 'C. I’m am', isCorrect: false }, { text: 'D. I I’m', isCorrect: false } ],
                correctAnswer: 'A. I am',
                correctAnswer_vi: 'Tôi khỏe',
                hint_vi: 'Cách trả lời đầy đủ, đúng ngữ pháp cho câu hỏi "Bạn khỏe không?".',
                rationale_vi: 'Khi trả lời câu hỏi sức khỏe, ta dùng "I am fine" hoặc "I\'m fine". "I\'m am" là sai ngữ pháp. Câu hoàn chỉnh: "I am fine, thanks." nghĩa là "Tôi khỏe, cảm ơn.".'
            },
            {
                type: 'mc',
                question: '9. Odd one out:',
                options: [ { text: 'A. fish', isCorrect: false }, { text: 'B. cat', isCorrect: false }, { text: 'C. dog', isCorrect: false }, { text: 'D. book', isCorrect: true } ],
                correctAnswer: 'D. book',
                correctAnswer_vi: 'quyển sách',
                hint_vi: 'Hãy tìm một từ không thuộc nhóm "động vật".',
                rationale_vi: '"fish" (cá), "cat" (mèo), và "dog" (chó) đều là động vật. "book" (quyển sách) là một đồ vật, nên nó khác loại.'
            },
            {
                type: 'rearrange',
                question: '10. Sắp xếp các từ sau:',
                words: ["school.", "we", "This is", "go to", "the way"],
                correctAnswer: "This is the way we go to school.",
                correctAnswer_vi: 'Đây là cách chúng tôi đến trường.',
                hint_vi: 'Câu này mô tả cách thức đi đến trường, thường bắt đầu bằng "This is...".',
                rationale_vi: 'Đây là một câu mô tả. Cấu trúc hợp lý là "This is the way we go to school." có nghĩa là "Đây là cách chúng tôi đến trường.".'
            },
            {
                type: 'multimedia',
                mediaType: 'image',
                imagePrompt: 'A teacher gesturing for a student to sit down.',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/2-dt-34.jpg',
                question: '11. Sit __wn, please!',
                correctAnswer: 'do',
                correctAnswer_vi: 'do (để tạo thành "down")',
                hint_vi: 'Từ còn thiếu kết hợp với "Sit" để tạo thành cụm từ có nghĩa là "ngồi xuống".',
                rationale_vi: 'Cụm từ "Sit down" có nghĩa là "Ngồi xuống". Câu hoàn chỉnh: "Sit down, please!" nghĩa là "Làm ơn ngồi xuống!".'
            },
            {
                type: 'mc',
                question: '12. Choose the odd one out:',
                options: [ { text: 'A. she', isCorrect: false }, { text: 'B. my', isCorrect: true }, { text: 'C. he', isCorrect: false }, { text: 'D. you', isCorrect: false } ],
                correctAnswer: 'B. my',
                correctAnswer_vi: 'của tôi',
                hint_vi: 'Tìm từ không phải là đại từ nhân xưng làm chủ ngữ (I, you, he, she...).',
                rationale_vi: '"she", "he", "you" là các đại từ nhân xưng (personal pronouns). "my" là một tính từ sở hữu (possessive adjective), dùng để chỉ sự sở hữu.'
            },
            {
                type: 'fill-in-the-blank',
                question: '13. How ___ are you? – I’m seven years old.',
                correctAnswer: 'old',
                correctAnswer_vi: 'tuổi',
                hint_vi: 'Câu hỏi này dùng để hỏi về tuổi tác.',
                rationale_vi: 'Cụm từ để hỏi tuổi là "How old are you?". Câu hoàn chỉnh: "How old are you?" có nghĩa là "Bạn bao nhiêu tuổi?".'
            },
            {
                type: 'rearrange',
                question: '14. Sắp xếp các từ sau:',
                words: ["am fine", ", thanks.", "I", "you?", "And"],
                correctAnswer: "I am fine, thanks. And you?",
                correctAnswer_vi: 'Tôi khỏe, cảm ơn. Còn bạn thì sao?',
                hint_vi: 'Đây là một câu trả lời và hỏi lại về sức khỏe trong hội thoại.',
                rationale_vi: 'Đây là một mẫu hội thoại thông thường. Đầu tiên trả lời ("I am fine, thanks.") sau đó hỏi lại ("And you?"). Câu hoàn chỉnh: "I am fine, thanks. And you?" nghĩa là "Tôi khỏe, cảm ơn. Còn bạn thì sao?".'
            },
            {
                type: 'mc',
                question: '15. ... are you? – I’m fine, thanks.',
                options: [ { text: 'A. Hi', isCorrect: false }, { text: 'B. Hello', isCorrect: false }, { text: 'C. How', isCorrect: true }, { text: 'D. How’s', isCorrect: false } ],
                correctAnswer: 'C. How',
                correctAnswer_vi: 'Như thế nào',
                hint_vi: 'Câu trả lời là "I\'m fine", vậy từ để hỏi là gì?',
                rationale_vi: 'Câu hỏi "How are you?" được dùng để hỏi thăm sức khỏe và câu trả lời tương ứng là "I\'m fine, thanks.".'
            },
            {
                type: 'multimedia',
                mediaType: 'image',
                imagePrompt: 'A chess board.',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/4-dt-45.jpg',
                question: '16. CH_SS',
                correctAnswer: 'E',
                correctAnswer_vi: 'E (để tạo thành "CHESS")',
                hint_vi: 'Tên một môn thể thao trí tuệ, được gọi là "cờ vua" trong tiếng Việt.',
                rationale_vi: 'Từ đúng là "CHESS" (cờ vua).'
            },
            {
                type: 'rearrange',
                question: '17. Sắp xếp các từ sau:',
                words: ["and", "My brother", "two dogs.", "has", "a cat"],
                correctAnswer: "My brother has a cat and two dogs.",
                correctAnswer_vi: 'Anh trai tôi có một con mèo và hai con chó.',
                hint_vi: 'Câu này kể về những con vật mà anh trai tôi sở hữu.',
                rationale_vi: 'Cấu trúc câu: Chủ ngữ (My brother) + động từ (has) + danh sách các vật sở hữu (a cat and two dogs). Câu hoàn chỉnh: "My brother has a cat and two dogs.".'
            },
            {
                type: 'rearrange',
                question: '18. Sắp xếp các từ sau:',
                words: ["A", "in the classroom.", "is", "black board"],
                correctAnswer: "A black board is in the classroom.",
                correctAnswer_vi: 'Có một cái bảng đen ở trong lớp học.',
                hint_vi: 'Câu này mô tả vị trí của một đồ vật trong lớp học.',
                rationale_vi: 'Cấu trúc câu: Chủ ngữ (A black board) + động từ "to be" (is) + cụm giới từ chỉ nơi chốn (in the classroom). Câu hoàn chỉnh: "A black board is in the classroom.".'
            },
            {
                type: 'multimedia',
                mediaType: 'image',
                imagePrompt: 'Two black cats.',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207308239844588_566X320.jpg',
                question: '19. These cats are _____ .',
                correctAnswer: 'black',
                correctAnswer_vi: 'màu đen',
                hint_vi: 'Nhìn vào bức ảnh và điền màu sắc của những con mèo.',
                rationale_vi: 'Hình ảnh cho thấy những con mèo màu đen. Câu hoàn chỉnh: "These cats are black." có nghĩa là "Những con mèo này màu đen.".'
            },
            {
                type: 'rearrange',
                question: '20. Sắp xếp các từ sau:',
                words: ["new", "my", "teacher.", "is", "Miss Lien"],
                correctAnswer: "Miss Lien is my new teacher.",
                correctAnswer_vi: 'Cô Liên là giáo viên mới của tôi.',
                hint_vi: 'Câu này dùng để giới thiệu cô Liên là ai.',
                rationale_vi: 'Cấu trúc câu giới thiệu: Tên riêng (Miss Lien) + động từ "to be" (is) + cụm danh từ (my new teacher). Câu hoàn chỉnh: "Miss Lien is my new teacher.".'
            },
            {
                type: 'fill-in-the-blank',
                question: '21. A: ____’s it? - B: It’s my notebook.',
                correctAnswer: 'What',
                correctAnswer_vi: 'Cái gì',
                hint_vi: 'Câu trả lời nói về một đồ vật ("my notebook"), vậy câu hỏi bắt đầu bằng từ gì?',
                rationale_vi: 'Để hỏi về một đồ vật, ta dùng "What". Câu hoàn chỉnh: "What\'s it?" có nghĩa là "Nó là cái gì?".'
            },
            {
                type: 'fill-in-the-blank',
                question: '22. Point __ the teacher.',
                correctAnswer: 'to',
                correctAnswer_vi: 'vào',
                hint_vi: 'Động từ "Point" (chỉ) thường đi với giới từ nào?',
                rationale_vi: 'Cụm động từ "point to" có nghĩa là "chỉ vào ai/cái gì". Câu hoàn chỉnh: "Point to the teacher." có nghĩa là "Hãy chỉ vào giáo viên.".'
            },
            {
                type: 'mc',
                question: '23. Is your school new? - No. It\'s _____.',
                options: [ { text: 'A. new', isCorrect: false }, { text: 'B. old', isCorrect: true }, { text: 'C. not', isCorrect: false }, { text: 'D. is', isCorrect: false } ],
                correctAnswer: 'B. old',
                correctAnswer_vi: 'cũ',
                hint_vi: 'Câu trả lời là "No", vậy trường học không "new" (mới) thì nó sẽ như thế nào?',
                rationale_vi: 'Câu trả lời là "No" nên cần một từ trái nghĩa với "new", đó là "old" (cũ). Câu hoàn chỉnh: "No. It\'s old." có nghĩa là "Không. Nó cũ rồi.".'
            },
            {
                type: 'mc',
                question: '24. … that woman your new teacher?',
                options: [ { text: 'A. Is', isCorrect: true }, { text: 'B. Has', isCorrect: false }, { text: 'C. Who’s', isCorrect: false }, { text: 'D. Does', isCorrect: false } ],
                correctAnswer: 'A. Is',
                correctAnswer_vi: 'Có phải',
                hint_vi: 'Đây là câu hỏi Yes/No với chủ ngữ là ngôi thứ ba số ít ("that woman").',
                rationale_vi: 'Để hỏi "Có phải...là..." với chủ ngữ số ít ("that woman"), ta dùng động từ "to be" là "Is". Câu hoàn chỉnh: "Is that woman your new teacher?" nghĩa là "Người phụ nữ kia có phải là giáo viên mới của bạn không?".'
            },
            {
                type: 'fill-in-the-blank',
                question: '25. Stand u_, please.',
                correctAnswer: 'p',
                correctAnswer_vi: 'p (để tạo thành "up")',
                hint_vi: 'Cụm từ này trái nghĩa với "Sit down" (ngồi xuống).',
                rationale_vi: 'Cụm từ "Stand up" có nghĩa là "Đứng lên". Câu hoàn chỉnh: "Stand up, please." có nghĩa là "Làm ơn đứng lên.".'
            },
            {
                type: 'mc',
                question: '26. Is your classroom big? - …, it isn\'t. It’s small.',
                options: [ { text: 'A. Yes', isCorrect: false }, { text: 'B. Yes, it isn’t', isCorrect: false }, { text: 'C. No, it is', isCorrect: false }, { text: 'D. No', isCorrect: true } ],
                correctAnswer: 'D. No',
                correctAnswer_vi: 'Không',
                hint_vi: 'Vế sau của câu trả lời là "it isn\'t", đây là một câu phủ định.',
                rationale_vi: 'Vế sau là "it isn\'t" (phủ định), vì vậy câu trả lời phải bắt đầu bằng "No". Các đáp án khác sai về logic hoặc ngữ pháp. Câu hoàn chỉnh: "No, it isn\'t.".'
            },
            {
                type: 'rearrange',
                question: '27. Sắp xếp các từ sau:',
                words: ["your", "to", "friend.", "Listen"],
                correctAnswer: "Listen to your friend.",
                correctAnswer_vi: 'Hãy lắng nghe bạn của bạn.',
                hint_vi: 'Đây là một câu yêu cầu. Động từ "Listen" thường đi kèm với giới từ "to".',
                rationale_vi: 'Cấu trúc câu mệnh lệnh bắt đầu bằng động từ "Listen". Cụm từ là "listen to". Câu hoàn chỉnh: "Listen to your friend." có nghĩa là "Hãy lắng nghe bạn của bạn.".'
            },
            {
                type: 'mc',
                question: '28. I’m ... , thank you. And you?',
                options: [ { text: 'A. nice', isCorrect: false }, { text: 'B. bye', isCorrect: false }, { text: 'C. fine', isCorrect: true }, { text: 'D. hi', isCorrect: false } ],
                correctAnswer: 'C. fine',
                correctAnswer_vi: 'khỏe',
                hint_vi: 'Đây là câu trả lời phổ biến cho câu hỏi "How are you?".',
                rationale_vi: '"I\'m fine" là cách trả lời thông dụng cho câu hỏi thăm sức khỏe. Câu hoàn chỉnh: "I\'m fine, thank you. And you?" có nghĩa là "Tôi khỏe, cảm ơn. Còn bạn thì sao?".'
            },
            {
                type: 'mc',
                question: '29. … ? – It’s black.',
                options: [ { text: 'A. What colour is it', isCorrect: true }, { text: 'B. What is this', isCorrect: false }, { text: 'C. How are you', isCorrect: false }, { text: 'D. How many', isCorrect: false } ],
                correctAnswer: 'A. What colour is it',
                correctAnswer_vi: 'Nó màu gì?',
                hint_vi: 'Câu trả lời là một màu sắc ("black"), vậy câu hỏi phải về chủ đề gì?',
                rationale_vi: 'Câu trả lời là một màu sắc ("black"), vì vậy câu hỏi phải là về màu sắc. "What colour is it?" là câu hỏi đúng. Câu hỏi và trả lời hoàn chỉnh: "What colour is it? - It\'s black.".'
            },
            {
                type: 'rearrange',
                question: '30. Sắp xếp các từ sau:',
                words: ["Simon.", "Come", "over", "here,"],
                correctAnswer: "Come over here, Simon.",
                correctAnswer_vi: 'Lại đây, Simon.',
                hint_vi: 'Cụm từ "Come over here" là một cách gọi ai đó lại gần.',
                rationale_vi: 'Cụm từ "Come over here" có nghĩa là "Lại đây". Tên người "Simon" thường được đặt ở cuối câu sau dấu phẩy. Câu hoàn chỉnh: "Come over here, Simon.".'
            },
            {
                type: 'mc',
                question: '31. Is this your ruler? - No, ____ isn\'t',
                options: [ { text: 'A. it', isCorrect: true }, { text: 'B. that', isCorrect: false }, { text: 'C. its', isCorrect: false }, { text: 'D. it\'s', isCorrect: false } ],
                correctAnswer: 'A. it',
                correctAnswer_vi: 'nó',
                hint_vi: 'Dùng đại từ nào để thay thế cho "this ruler" trong câu trả lời?',
                rationale_vi: 'Ta dùng đại từ "it" để thay thế cho một vật ("this ruler") trong câu trả lời. "it\'s" là viết tắt của "it is". Câu hoàn chỉnh: "No, it isn\'t.".'
            },
            {
                type: 'rearrange',
                question: '32. Sắp xếp các từ sau:',
                words: ["the pink", "pen,", "please.", "Give", "me"],
                correctAnswer: "Give me the pink pen, please.",
                correctAnswer_vi: 'Làm ơn đưa cho tôi cây bút màu hồng.',
                hint_vi: 'Đây là câu yêu cầu ai đó đưa cho mình một vật gì.',
                rationale_vi: 'Cấu trúc câu mệnh lệnh: Give + tân ngữ gián tiếp (me) + tân ngữ trực tiếp (the pink pen). "please" có thể đứng cuối câu. Câu hoàn chỉnh: "Give me the pink pen, please.".'
            },
            {
                type: 'multimedia',
                mediaType: 'image',
                imagePrompt: 'Four children with numbers on them. The girl in the yellow shirt has number 3.',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/2/636505021981546006_566X320.jpg',
                question: '33. Who’s Tracy? - The girl is in the yellow shirt. Which number is she?',
                options: [ { text: 'A. 1', isCorrect: false }, { text: 'B. 2', isCorrect: false }, { text: 'C. 3', isCorrect: false }, { text: 'D. 4', isCorrect: true } ],
                correctAnswer: 'D. 4',
                correctAnswer_vi: 'Số 4',
                hint_vi: 'Tìm cô gái mặc áo màu vàng ("yellow shirt") và xem cô ấy được đánh số mấy.',
                rationale_vi: 'Trong bức ảnh, cô gái mặc áo màu vàng được đánh số 4. Vì vậy, Tracy là số 4.'
            },
            {
                type: 'rearrange',
                question: '34. Sắp xếp các từ sau:',
                words: ["Don't", "girls!", "in class,", "talk"],
                correctAnswer: "Don't talk in class, girls!",
                correctAnswer_vi: 'Đừng nói chuyện trong lớp, các cô gái!',
                hint_vi: 'Đây là một câu mệnh lệnh phủ định, yêu cầu không làm gì đó.',
                rationale_vi: 'Cấu trúc câu mệnh lệnh phủ định: Don\'t + động từ (talk) + cụm từ chỉ nơi chốn (in class). "girls" là lời gọi, đặt ở cuối. Câu hoàn chỉnh: "Don\'t talk in class, girls!".'
            },
            {
                type: 'fill-in-the-blank',
                question: '35. Is it _ ruler? – No, it isn’t.',
                correctAnswer: 'a',
                correctAnswer_vi: 'một',
                hint_vi: 'Từ "ruler" bắt đầu bằng một phụ âm, vậy ta dùng mạo từ không xác định nào?',
                rationale_vi: 'Dùng mạo từ "a" trước danh từ đếm được số ít bắt đầu bằng một phụ âm ("ruler"). Câu hoàn chỉnh: "Is it a ruler?" nghĩa là "Nó có phải là một cái thước kẻ không?".'
            },
            {
                type: 'mc',
                question: '36. Jack ___ in the playground.',
                options: [ { text: 'A. are', isCorrect: false }, { text: 'B. am', isCorrect: false }, { text: 'C. is', isCorrect: true }, { text: 'D. be', isCorrect: false } ],
                correctAnswer: 'C. is',
                correctAnswer_vi: 'thì, là, ở',
                hint_vi: 'Chủ ngữ là "Jack", một tên riêng (ngôi thứ ba số ít).',
                rationale_vi: 'Chủ ngữ "Jack" là ngôi thứ ba số ít, nên động từ "to be" phải chia là "is". Câu hoàn chỉnh: "Jack is in the playground." có nghĩa là "Jack đang ở trong sân chơi.".'
            },
            {
                type: 'mc',
                question: '37. I go to school ___ my classmates.',
                options: [ { text: 'A. in', isCorrect: false }, { text: 'B. and', isCorrect: false }, { text: 'C. but', isCorrect: false }, { text: 'D. with', isCorrect: true } ],
                correctAnswer: 'D. with',
                correctAnswer_vi: 'với',
                hint_vi: 'Giới từ nào có nghĩa là "cùng với"?',
                rationale_vi: '"With" là giới từ có nghĩa là "cùng với", chỉ sự đồng hành. Câu hoàn chỉnh: "I go to school with my classmates." có nghĩa là "Tôi đi học cùng với các bạn cùng lớp.".'
            },
            {
                type: 'fill-in-the-blank',
                question: '38. W__t is this? – This is a marker.',
                correctAnswer: 'ha',
                correctAnswer_vi: 'ha (để tạo thành "What")',
                hint_vi: 'Từ để hỏi về một vật, bắt đầu bằng "W" và kết thúc bằng "t".',
                rationale_vi: 'Từ để hỏi là "What" (cái gì). Câu hoàn chỉnh: "What is this?" có nghĩa là "Đây là cái gì?".'
            },
            {
                type: 'mc',
                question: '39. May I go out? - ... .',
                options: [ { text: 'A. Hello', isCorrect: false }, { text: 'B. Nice to meet you', isCorrect: false }, { text: 'C. Fine, thanks', isCorrect: false }, { text: 'D. Sure', isCorrect: true } ],
                correctAnswer: 'D. Sure',
                correctAnswer_vi: 'Chắc chắn rồi',
                hint_vi: 'Đây là một cách trả lời đồng ý cho một lời xin phép.',
                rationale_vi: '"Sure" (Chắc chắn rồi) là một cách lịch sự và phổ biến để đồng ý với câu hỏi xin phép "May I...?".'
            },
            {
                type: 'fill-in-the-blank',
                question: '40. That’s my fathe_.',
                correctAnswer: 'r',
                correctAnswer_vi: 'r (để tạo thành "father")',
                hint_vi: 'Từ này có nghĩa là "bố" hoặc "cha" trong tiếng Anh.',
                rationale_vi: 'Từ đúng là "father" (bố). Câu hoàn chỉnh: "That’s my father." có nghĩa là "Đó là bố của tôi.".'
            },
            {
                type: 'rearrange',
                question: '41. Sắp xếp các từ sau:',
                words: ["that,", "Who's", "Peter?"],
                correctAnswer: "Who's that, Peter?",
                correctAnswer_vi: 'Ai kia, Peter?',
                hint_vi: 'Đây là câu hỏi về một người, đồng thời gọi tên "Peter".',
                rationale_vi: 'Cấu trúc câu hỏi: "Who\'s that?" để hỏi về một người ở xa. Tên "Peter" được thêm vào cuối như một lời gọi. Câu hoàn chỉnh: "Who\'s that, Peter?".'
            },
            {
                type: 'mc',
                question: '42. I go to school library to ... books.',
                options: [ { text: 'A. read’s', isCorrect: false }, { text: 'B. reads', isCorrect: false }, { text: 'C. read', isCorrect: true }, { text: 'D. read to', isCorrect: false } ],
                correctAnswer: 'C. read',
                correctAnswer_vi: 'đọc',
                hint_vi: 'Sau "to" trong cấu trúc chỉ mục đích, động từ ở dạng nào?',
                rationale_vi: 'Sau "to" để chỉ mục đích, ta dùng động từ nguyên thể không "to" (infinitive). "read" là động từ nguyên thể. Câu hoàn chỉnh: "I go to school library to read books." có nghĩa là "Tôi đến thư viện trường để đọc sách.".'
            },
            {
                type: 'rearrange',
                question: '43. Sắp xếp các từ sau:',
                words: ["Are", "sick", "you", "today?"],
                correctAnswer: "Are you sick today?",
                correctAnswer_vi: 'Hôm nay bạn có bị ốm không?',
                hint_vi: 'Đây là một câu hỏi Yes/No về tình trạng sức khỏe.',
                rationale_vi: 'Cấu trúc câu hỏi Yes/No với "to be": Are + chủ ngữ (you) + tính từ (sick) + ...?. Câu hoàn chỉnh: "Are you sick today?".'
            },
            {
                type: 'rearrange',
                question: '44. Sắp xếp các từ sau:',
                words: ["books", "How", "there?", "many", "are"],
                correctAnswer: "How many books are there?",
                correctAnswer_vi: 'Có bao nhiêu quyển sách ở đó?',
                hint_vi: 'Đây là câu hỏi về số lượng, bắt đầu bằng "How many".',
                rationale_vi: 'Cấu trúc câu hỏi số lượng: How many + danh từ số nhiều (books) + are there?. Câu hoàn chỉnh: "How many books are there?".'
            },
            {
                type: 'mc',
                question: '45. Hi, I’m Collin. Nice to meet ....',
                options: [ { text: 'A. me', isCorrect: false }, { text: 'B. they', isCorrect: false }, { text: 'C. he', isCorrect: false }, { text: 'D. you', isCorrect: true } ],
                correctAnswer: 'D. you',
                correctAnswer_vi: 'bạn',
                hint_vi: 'Đây là một câu chào hỏi thông dụng khi lần đầu gặp mặt.',
                rationale_vi: 'Cụm từ cố định là "Nice to meet you" có nghĩa là "Rất vui được gặp bạn".'
            },
            {
                type: 'mc',
                question: '46. ... this a pencil?',
                options: [ { text: 'A. Are', isCorrect: false }, { text: 'B. You', isCorrect: false }, { text: 'C. Is', isCorrect: true }, { text: 'D. My', isCorrect: false } ],
                correctAnswer: 'C. Is',
                correctAnswer_vi: 'Có phải',
                hint_vi: 'Chủ ngữ là "this", một danh từ số ít.',
                rationale_vi: 'Với chủ ngữ số ít "this", ta dùng động từ "to be" là "Is" để bắt đầu câu hỏi Yes/No. Câu hoàn chỉnh: "Is this a pencil?" nghĩa là "Đây có phải là một cái bút chì không?".'
            },
            {
                type: 'multimedia',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206312811331111_Audio.mp3',
                question: '47. Listen to the audio. I’m standing in a ... .',
                options: [ { text: 'A. living room', isCorrect: false }, { text: 'B. classroom', isCorrect: true }, { text: 'C. room', isCorrect: false }, { text: 'D. bedroom', isCorrect: false } ],
                correctAnswer: 'B. classroom',
                correctAnswer_vi: 'lớp học',
                hint_vi: 'Hãy nghe kỹ đoạn audio để xác định địa điểm được nhắc đến.',
                rationale_vi: 'Đoạn audio nói về việc đang đứng trong một "classroom" (lớp học). Câu hoàn chỉnh được nghe là: "I’m standing in a classroom.".'
            },
            {
                type: 'multimedia',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Audio/3-dt-36.mp3',
                question: '48. I like basketba__.',
                correctAnswer: 'll',
                correctAnswer_vi: 'll (để tạo thành "basketball")',
                hint_vi: 'Tên một môn thể thao với quả bóng màu cam, được gọi là "bóng rổ".',
                rationale_vi: 'Từ đúng là "basketball" (bóng rổ). Câu hoàn chỉnh được nghe là: "I like basketball." có nghĩa là "Tôi thích bóng rổ.".'
            },
            {
                type: 'multimedia',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Audio/3-tn-27.mp3',
                question: '49. The school _______ is large.',
                options: [ { text: 'A. gym', isCorrect: false }, { text: 'B. school', isCorrect: false }, { text: 'C. room', isCorrect: false }, { text: 'D. library', isCorrect: true } ],
                correctAnswer: 'D. library',
                correctAnswer_vi: 'thư viện',
                hint_vi: 'Nghe và điền vào chỗ trống tên một bộ phận của trường học.',
                rationale_vi: 'Đoạn audio mô tả "thư viện trường" ("school library") thì lớn. Câu hoàn chỉnh được nghe là: "The school library is large.".'
            },
            {
                type: 'rearrange',
                question: '50. Sắp xếp các từ sau:',
                words: ["the teacher", "Write", "what", "says."],
                correctAnswer: "Write what the teacher says.",
                correctAnswer_vi: 'Viết những gì giáo viên nói.',
                hint_vi: 'Đây là một câu mệnh lệnh, yêu cầu học sinh làm theo lời giáo viên.',
                rationale_vi: 'Câu mệnh lệnh bắt đầu bằng động từ "Write". "what the teacher says" là mệnh đề danh ngữ. Câu hoàn chỉnh: "Write what the teacher says.".'
            },
            {
                type: 'fill-in-the-blank',
                question: '51. Unscramble this word: ’’YBEDOGO’’ -> ’’GOOD___’’.',
                correctAnswer: 'BYE',
                correctAnswer_vi: 'BYE (để tạo thành "GOODBYE")',
                hint_vi: 'Sắp xếp lại các chữ cái trong "YBEDOGO" để tạo thành một từ chào tạm biệt.',
                rationale_vi: 'Các chữ cái trong "YBEDOGO" khi sắp xếp lại sẽ tạo thành từ "GOODBYE" (Tạm biệt).'
            },
            {
                type: 'mc',
                question: '52. A: … that boy your friend? - B: Yes, ….',
                options: [ { text: 'A. Are – they are', isCorrect: false }, { text: 'B. Are – they aren’t', isCorrect: false }, { text: 'C. Is – he isn’t', isCorrect: false }, { text: 'D. Is – he is', isCorrect: true } ],
                correctAnswer: 'D. Is – he is',
                correctAnswer_vi: 'Có phải... - Vâng, đúng vậy',
                hint_vi: 'Chủ ngữ "that boy" là số ít. Câu trả lời là "Yes", vậy vế sau phải là khẳng định.',
                rationale_vi: 'Chủ ngữ "that boy" là số ít, nên câu hỏi phải bắt đầu bằng "Is". Câu trả lời là "Yes" nên vế sau phải là khẳng định "he is". Câu hoàn chỉnh: "Is that boy your friend? - Yes, he is.".'
            },
            {
                type: 'fill-in-the-blank',
                question: '53. My school __ new.',
                correctAnswer: 'is',
                correctAnswer_vi: 'thì, là',
                hint_vi: 'Chủ ngữ là "My school", ngôi thứ ba số ít.',
                rationale_vi: 'Chủ ngữ "My school" là ngôi thứ ba số ít, nên động từ "to be" phải chia là "is". Câu hoàn chỉnh: "My school is new." nghĩa là "Trường của tôi thì mới.".'
            },
            {
                type: 'mc',
                question: '54. Odd one out:',
                options: [ { text: 'A. fish', isCorrect: false }, { text: 'B. cat', isCorrect: false }, { text: 'C. dog', isCorrect: false }, { text: 'D. book', isCorrect: true } ],
                correctAnswer: 'D. book',
                correctAnswer_vi: 'quyển sách',
                hint_vi: 'Hãy tìm một từ không thuộc nhóm "động vật".',
                rationale_vi: '"fish" (cá), "cat" (mèo), và "dog" (chó) đều là động vật. "book" (quyển sách) là một đồ vật, nên nó khác loại.'
            },
            {
                type: 'multimedia',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/11/30/636161053165241455_Audio.mp3',
                question: '55. It’s a ___ blue green ball.',
                correctAnswer: 'big',
                correctAnswer_vi: 'to lớn',
                hint_vi: 'Nghe đoạn audio để biết tính từ mô tả kích thước của quả bóng.',
                rationale_vi: 'Đoạn audio mô tả quả bóng là "big" (to). Câu hoàn chỉnh được nghe là: "It’s a big blue green ball." có nghĩa là "Đó là một quả bóng to màu xanh dương và xanh lá.".'
            },
            {
                type: 'mc',
                question: '56. Lan and Hoa ___ in class 3C.',
                options: [ { text: 'A. is', isCorrect: false }, { text: 'B. am', isCorrect: false }, { text: 'C. are', isCorrect: true }, { text: 'D. on', isCorrect: false } ],
                correctAnswer: 'C. are',
                correctAnswer_vi: 'thì, là, ở',
                hint_vi: 'Chủ ngữ là "Lan and Hoa", gồm hai người, là số nhiều.',
                rationale_vi: 'Chủ ngữ "Lan and Hoa" là số nhiều, nên động từ "to be" phải chia là "are". Câu hoàn chỉnh: "Lan and Hoa are in class 3C." có nghĩa là "Lan và Hoa học lớp 3C.".'
            },
            {
                type: 'multimedia',
                mediaType: 'image',
                imagePrompt: 'A blue shirt.',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/23/635208321994581633_566X320.jpg',
                question: '57. That is a blue s____.',
                correctAnswer: 'hip',
                correctAnswer_vi: 'hip (để tạo thành "ship")',
                hint_vi: 'Trong ảnh là một chiếc "thuyền" màu xanh.',
                rationale_vi: 'Từ đúng là "ship" (thuyền). Câu hoàn chỉnh: "That is a blue ship." có nghĩa là "Đó là một chiếc thuyền màu xanh.".'
            },
            {
                type: 'fill-in-the-blank',
                question: '58. Let’s make a ci_cle.',
                correctAnswer: 'r',
                correctAnswer_vi: 'r (để tạo thành "circle")',
                hint_vi: 'Từ này có nghĩa là "hình tròn".',
                rationale_vi: 'Từ đúng là "circle" (hình tròn). Câu hoàn chỉnh: "Let’s make a circle." có nghĩa là "Chúng ta hãy tạo thành một vòng tròn nào.".'
            },
            {
                type: 'multimedia',
                mediaType: 'image',
                imagePrompt: 'Books placed on a table.',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi%20Th%E1%BB%AD/Thi_trai_nghiem_2021/Lop3/images1/dt.jpg',
                question: '59. Put your books on the tabl_.',
                correctAnswer: 'e',
                correctAnswer_vi: 'e (để tạo thành "table")',
                hint_vi: 'Đồ vật trong ảnh mà bạn đặt sách lên là "cái bàn".',
                rationale_vi: 'Từ đúng là "table" (cái bàn). Câu hoàn chỉnh: "Put your books on the table." có nghĩa là "Hãy đặt sách của bạn lên bàn.".'
            },
            {
                type: 'multimedia',
                mediaType: 'image',
                imagePrompt: 'Children playing computer games.',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207295518636244_566X320.jpg',
                question: '60. My brother likes playing ________ games.',
                correctAnswer: 'computer',
                correctAnswer_vi: 'máy tính',
                hint_vi: 'Loại trò chơi được chơi trên máy tính gọi là gì?',
                rationale_vi: 'Cụm từ "computer games" có nghĩa là "trò chơi máy tính". Câu hoàn chỉnh: "My brother likes playing computer games." nghĩa là "Anh trai tôi thích chơi game trên máy tính.".'
            },
            {
                type: 'mc',
                question: '61. Goodbye. ...',
                options: [ { text: 'A. Nice to meet you', isCorrect: false }, { text: 'B. See you later', isCorrect: true }, { text: 'C. Good morning', isCorrect: false }, { text: 'D. Good evening', isCorrect: false } ],
                correctAnswer: 'B. See you later',
                correctAnswer_vi: 'Hẹn gặp lại sau',
                hint_vi: 'Khi ai đó nói "Tạm biệt", bạn có thể đáp lại bằng câu nào để hẹn gặp lại?',
                rationale_vi: '"See you later" (Hẹn gặp lại sau) là một cách phổ biến để đáp lại "Goodbye".'
            },
            {
                type: 'multimedia',
                mediaType: 'image',
                imagePrompt: 'A small classroom.',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/23/635208311247935975_566X320.jpg',
                question: '62. Our ________ is not big.',
                correctAnswer: 'bathroom',
                correctAnswer_vi: 'phòng tắm',
                hint_vi: 'Nơi để tắm được gọi là gì?',
                rationale_vi: 'Từ đúng là "bathroom" (phòng tắm). Câu hoàn chỉnh: "Our bathroom is not big." có nghĩa là "Phòng tắm của chúng tôi không lớn.".'
            },
            {
                type: 'multimedia',
                mediaType: 'image',
                imagePrompt: 'A wooden table.',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/1-tn-40.jpg',
                question: '63. TA_LE',
                options: [ { text: 'A. P', isCorrect: false }, { text: 'B. B', isCorrect: true }, { text: 'C. C', isCorrect: false }, { text: 'D. G', isCorrect: false } ],
                correctAnswer: 'B. B',
                correctAnswer_vi: 'B (để tạo thành "TABLE")',
                hint_vi: 'Từ này có nghĩa là "cái bàn" trong tiếng Anh.',
                rationale_vi: 'Từ đúng là "TABLE" (cái bàn).'
            },
            {
                type: 'mc',
                question: '64. Gale ______ books in the school library.',
                options: [ { text: 'A. listens', isCorrect: false }, { text: 'B. speaks', isCorrect: false }, { text: 'C. says', isCorrect: false }, { text: 'D. reads', isCorrect: true } ],
                correctAnswer: 'D. reads',
                correctAnswer_vi: 'đọc',
                hint_vi: 'Hành động mà mọi người thường làm với sách trong thư viện là gì?',
                rationale_vi: 'Ở thư viện, người ta thường "reads books" (đọc sách). Chủ ngữ "Gale" là ngôi thứ ba số ít nên động từ thêm "s". Câu hoàn chỉnh: "Gale reads books in the school library.".'
            },
            {
                type: 'mc',
                question: '65. ____ are his pets.',
                options: [ { text: 'A. These', isCorrect: true }, { text: 'B. This', isCorrect: false }, { text: 'C. That', isCorrect: false }, { text: 'D. It', isCorrect: false } ],
                correctAnswer: 'A. These',
                correctAnswer_vi: 'Đây là (số nhiều)',
                hint_vi: 'Động từ trong câu là "are" và danh từ "pets" ở số nhiều.',
                rationale_vi: 'Vì động từ là "are" và danh từ "pets" ở số nhiều, ta phải dùng đại từ chỉ định số nhiều là "These". Câu hoàn chỉnh: "These are his pets." có nghĩa là "Đây là những con thú cưng của anh ấy.".'
            },
            {
                type: 'rearrange',
                question: '66. Sắp xếp các từ sau:',
                words: ["is", "name?", "your", "What", "mother's"],
                correctAnswer: "What is your mother's name?",
                correctAnswer_vi: 'Tên của mẹ bạn là gì?',
                hint_vi: 'Đây là câu hỏi về tên của một người, bắt đầu bằng "What".',
                rationale_vi: 'Cấu trúc câu hỏi: What is + sở hữu cách (your mother\'s) + name?. Câu hoàn chỉnh: "What is your mother\'s name?".'
            },
            {
                type: 'fill-in-the-blank',
                question: '67. Is this __ eraser?',
                correctAnswer: 'an',
                correctAnswer_vi: 'một',
                hint_vi: 'Từ "eraser" bắt đầu bằng một nguyên âm ("e").',
                rationale_vi: 'Dùng mạo từ "an" trước danh từ đếm được số ít bắt đầu bằng một nguyên âm ("eraser"). Câu hoàn chỉnh: "Is this an eraser?" nghĩa là "Đây có phải là một cục tẩy không?".'
            },
            {
                type: 'rearrange',
                question: '68. Sắp xếp các từ sau:',
                words: ["my", "friends.", "are", "These"],
                correctAnswer: "These are my friends.",
                correctAnswer_vi: 'Đây là những người bạn của tôi.',
                hint_vi: 'Câu này dùng để giới thiệu nhiều người bạn.',
                rationale_vi: 'Cấu trúc câu giới thiệu số nhiều: These are + cụm danh từ. Câu hoàn chỉnh: "These are my friends.".'
            },
            {
                type: 'multimedia',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/4/636506592106747089_Audio.mp3',
                question: '69. Put the books … the table.',
                options: [ { text: 'A. under', isCorrect: false }, { text: 'B. on', isCorrect: true }, { text: 'C. next to', isCorrect: false }, { text: 'D. behind', isCorrect: false } ],
                correctAnswer: 'B. on',
                correctAnswer_vi: 'trên',
                hint_vi: 'Nghe đoạn audio để biết vị trí đặt những cuốn sách.',
                rationale_vi: 'Đoạn audio yêu cầu đặt sách "on the table" (trên bàn). Câu hoàn chỉnh được nghe là: "Put the books on the table.".'
            },
            {
                type: 'mc',
                question: '70. This is ... school bag.',
                options: [ { text: 'A. he’s', isCorrect: false }, { text: 'B. my’s', isCorrect: false }, { text: 'C. me', isCorrect: false }, { text: 'D. my', isCorrect: true } ],
                correctAnswer: 'D. my',
                correctAnswer_vi: 'của tôi',
                hint_vi: 'Từ nào dùng để chỉ sự sở hữu của "tôi"?',
                rationale_vi: '"my" là tính từ sở hữu đứng trước danh từ "school bag" để chỉ sự sở hữu. Câu hoàn chỉnh: "This is my school bag." nghĩa là "Đây là cặp đi học của tôi.".'
            },
            {
                type: 'multimedia',
                mediaType: 'image',
                imagePrompt: 'A ball inside a box.',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/4-tn-45.jpg',
                question: '71. The ball is ___ the box.',
                options: [ { text: 'A. in', isCorrect: true }, { text: 'B. on', isCorrect: false }, { text: 'C. at', isCorrect: false }, { text: 'D. of', isCorrect: false } ],
                correctAnswer: 'A. in',
                correctAnswer_vi: 'trong',
                hint_vi: 'Nhìn vào ảnh, quả bóng đang ở vị trí nào so với cái hộp?',
                rationale_vi: 'Bức ảnh cho thấy quả bóng ở "in" (bên trong) cái hộp. Câu hoàn chỉnh: "The ball is in the box." nghĩa là "Quả bóng ở trong cái hộp.".'
            },
            {
                type: 'multimedia',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206308991508402_Audio.mp3',
                question: '72. Listen and tick:',
                options: [ { text: 'A. This is my T-shirt.', isCorrect: false }, { text: 'B. This is my shirt.', isCorrect: false }, { text: 'C. This is my skirt.', isCorrect: true }, { text: 'D. This is my jeans.', isCorrect: false } ],
                correctAnswer: 'C. This is my skirt.',
                correctAnswer_vi: 'Đây là cái váy của tôi.',
                hint_vi: 'Nghe kỹ để phân biệt các từ chỉ quần áo có phát âm gần giống nhau.',
                rationale_vi: 'Đoạn audio nói "This is my skirt." có nghĩa là "Đây là cái váy của tôi.".'
            },
            {
                type: 'mc',
                question: '73. There is a picture … the wall.',
                options: [ { text: 'A. in', isCorrect: false }, { text: 'B. at', isCorrect: false }, { text: 'C. on', isCorrect: true }, { text: 'D. of', isCorrect: false } ],
                correctAnswer: 'C. on',
                correctAnswer_vi: 'trên',
                hint_vi: 'Giới từ nào được dùng để chỉ vật gì đó ở trên một bề mặt (như tường, bàn)?',
                rationale_vi: 'Bức tranh được treo "on the wall" (trên bề mặt của bức tường). Câu hoàn chỉnh: "There is a picture on the wall." nghĩa là "Có một bức tranh ở trên tường.".'
            },
            {
                type: 'mc',
                question: '74. Is this a pencil box? – ..., it is.',
                options: [ { text: 'A. No', isCorrect: false }, { text: 'B. Not', isCorrect: false }, { text: 'C. Yes', isCorrect: true }, { text: 'D. No’s', isCorrect: false } ],
                correctAnswer: 'C. Yes',
                correctAnswer_vi: 'Vâng, đúng vậy',
                hint_vi: 'Vế sau của câu trả lời là "it is", đây là một câu khẳng định.',
                rationale_vi: 'Vế sau là "it is" (khẳng định), vì vậy câu trả lời phải bắt đầu bằng "Yes". Câu hoàn chỉnh: "Yes, it is.".'
            },
            {
                type: 'mc',
                question: '75. Choose the odd one out',
                options: [ { text: 'A. Green', isCorrect: false }, { text: 'B. Yellow', isCorrect: false }, { text: 'C. Apple', isCorrect: true }, { text: 'D. Blue', isCorrect: false } ],
                correctAnswer: 'C. Apple',
                correctAnswer_vi: 'quả táo',
                hint_vi: 'Hãy tìm một từ không thuộc nhóm "màu sắc".',
                rationale_vi: '"Green" (xanh lá), "Yellow" (vàng), "Blue" (xanh dương) là các màu sắc. "Apple" (quả táo) là một loại quả, nên nó khác loại.'
            },
            {
                type: 'rearrange',
                question: '76. Sắp xếp các từ sau:',
                words: ["like", "My", "doesn’t", "brother", "cats."],
                correctAnswer: "My brother doesn’t like cats.",
                correctAnswer_vi: 'Anh trai tôi không thích mèo.',
                hint_vi: 'Đây là câu phủ định ở thì hiện tại đơn với chủ ngữ "My brother".',
                rationale_vi: 'Cấu trúc câu phủ định: Chủ ngữ (My brother) + trợ động từ phủ định (doesn’t) + động từ (like) + tân ngữ (cats). Câu hoàn chỉnh: "My brother doesn’t like cats.".'
            },
            {
                type: 'rearrange',
                question: '77. Sắp xếp các từ sau:',
                words: ["school", "large?", "Is", "your"],
                correctAnswer: "Is your school large?",
                correctAnswer_vi: 'Trường của bạn có lớn không?',
                hint_vi: 'Đây là câu hỏi Yes/No, bắt đầu bằng động từ "to be".',
                rationale_vi: 'Cấu trúc câu hỏi Yes/No với "to be": Is + cụm danh từ (your school) + tính từ (large)?. Câu hoàn chỉnh: "Is your school large?".'
            },
            {
                type: 'mc',
                question: '78. Choose the letter to make a correct word: blac_',
                options: [ { text: 'A. c', isCorrect: false }, { text: 'B. t', isCorrect: false }, { text: 'C. k', isCorrect: true }, { text: 'D. h', isCorrect: false } ],
                correctAnswer: 'C. k',
                correctAnswer_vi: 'k (để tạo thành "black")',
                hint_vi: 'Từ này có nghĩa là "màu đen" trong tiếng Anh.',
                rationale_vi: 'Từ đúng là "black" (màu đen).'
            },
            {
                type: 'fill-in-the-blank',
                question: '79. ___ do you spell your name, Sam? - It’s S-A-M.',
                correctAnswer: 'How',
                correctAnswer_vi: 'Như thế nào',
                hint_vi: 'Câu trả lời là về việc đánh vần, vậy từ để hỏi về "cách thức" là gì?',
                rationale_vi: 'Câu hỏi "How do you spell...?" dùng để hỏi cách đánh vần một từ. Câu hoàn chỉnh: "How do you spell your name, Sam?".'
            },
            {
                type: 'fill-in-the-blank',
                question: '80. Listen and ti__.',
                correctAnswer: 'ck',
                correctAnswer_vi: 'ck (để tạo thành "tick")',
                hint_vi: 'Từ này có nghĩa là "đánh dấu" vào một lựa chọn.',
                rationale_vi: 'Từ đúng là "tick" (đánh dấu). Câu hoàn chỉnh: "Listen and tick." có nghĩa là "Nghe và đánh dấu.".'
            },
            {
                type: 'fill-in-the-blank',
                question: '81. Let’s ma__ a line, students.',
                correctAnswer: 'ke',
                correctAnswer_vi: 'ke (để tạo thành "make")',
                hint_vi: 'Cụm từ này có nghĩa là "xếp thành một hàng".',
                rationale_vi: 'Cụm từ "make a line" có nghĩa là "xếp thành một hàng". Câu hoàn chỉnh: "Let’s make a line, students.".'
            },
            {
                type: 'rearrange',
                question: '82. Sắp xếp các từ sau:',
                words: ["eight", "I", "am", "years old."],
                correctAnswer: "I am eight years old.",
                correctAnswer_vi: 'Tôi tám tuổi.',
                hint_vi: 'Đây là câu trả lời cho câu hỏi về tuổi tác.',
                rationale_vi: 'Cấu trúc câu trả lời về tuổi: I am + số tuổi + years old. Câu hoàn chỉnh: "I am eight years old.".'
            },
            {
                type: 'rearrange',
                question: '83. Sắp xếp các từ sau:',
                words: ["me.", "after", "repeat", "Please"],
                correctAnswer: "Please repeat after me.",
                correctAnswer_vi: 'Làm ơn lặp lại theo tôi.',
                hint_vi: 'Đây là một câu yêu cầu lịch sự, thường bắt đầu bằng "Please".',
                rationale_vi: 'Cấu trúc câu mệnh lệnh lịch sự: Please + động từ (repeat) + ... . Cụm từ "repeat after me" có nghĩa là "lặp lại theo tôi". Câu hoàn chỉnh: "Please repeat after me.".'
            },
            {
                type: 'fill-in-the-blank',
                question: '84. Bye. S__ you later.',
                correctAnswer: 'ee',
                correctAnswer_vi: 'ee (để tạo thành "See")',
                hint_vi: 'Cụm từ này là một cách nói "Hẹn gặp lại sau".',
                rationale_vi: 'Cụm từ "See you later" có nghĩa là "Hẹn gặp lại sau". Câu hoàn chỉnh: "See you later.".'
            },
            {
                type: 'mc',
                question: '85. My classroom is … .',
                options: [ { text: 'A. name', isCorrect: false }, { text: 'B. news', isCorrect: false }, { text: 'C. new', isCorrect: true }, { text: 'D. names', isCorrect: false } ],
                correctAnswer: 'C. new',
                correctAnswer_vi: 'mới',
                hint_vi: 'Chọn một tính từ phù hợp để mô tả "lớp học".',
                rationale_vi: '"new" (mới) là một tính từ phù hợp để mô tả "classroom". Các từ còn lại là danh từ. Câu hoàn chỉnh: "My classroom is new." nghĩa là "Lớp học của tôi thì mới.".'
            },
            {
                type: 'fill-in-the-blank',
                question: '86. Nice __ see you.',
                correctAnswer: 'to',
                correctAnswer_vi: 'để',
                hint_vi: 'Đây là một cụm từ cố định dùng để chào hỏi khi gặp mặt.',
                rationale_vi: 'Cụm từ cố định là "Nice to see you" có nghĩa là "Rất vui được gặp bạn".'
            },
            {
                type: 'rearrange',
                question: '87. Sắp xếp các từ sau:',
                words: ["Put", "your", "down.", "hand"],
                correctAnswer: "Put your hand down.",
                correctAnswer_vi: 'Bỏ tay bạn xuống.',
                hint_vi: 'Đây là một câu yêu cầu, trái nghĩa với "Raise your hand".',
                rationale_vi: 'Cụm từ "put... down" có nghĩa là "đặt/bỏ... xuống". Cấu trúc câu mệnh lệnh: Động từ + tân ngữ + ... . Câu hoàn chỉnh: "Put your hand down.".'
            },
            {
                type: 'multimedia',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206364939134668_Audio.mp3',
                question: '88. There are ... boats on the sea.',
                options: [ { text: 'A. twenty', isCorrect: false }, { text: 'B. three', isCorrect: true }, { text: 'C. two', isCorrect: false }, { text: 'D. twelve', isCorrect: false } ],
                correctAnswer: 'B. three',
                correctAnswer_vi: 'ba',
                hint_vi: 'Nghe kỹ đoạn audio để đếm số lượng thuyền.',
                rationale_vi: 'Đoạn audio nói có "three" (ba) chiếc thuyền trên biển. Câu hoàn chỉnh được nghe là: "There are three boats on the sea.".'
            },
            {
                type: 'rearrange',
                question: '89. Sắp xếp các từ sau:',
                words: ["That", "green", "a", "is", "chair."],
                correctAnswer: "That is a green chair.",
                correctAnswer_vi: 'Đó là một cái ghế màu xanh lá.',
                hint_vi: 'Đây là câu mô tả một đồ vật, chỉ rõ màu sắc của nó.',
                rationale_vi: 'Cấu trúc: That is + mạo từ (a) + tính từ (green) + danh từ (chair). Câu hoàn chỉnh: "That is a green chair.".'
            },
            {
                type: 'multimedia',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/2/636504878931926679_Audio.mp3',
                question: '90. These are your new … and ….',
                options: [ { text: 'A. bookcases – boards', isCorrect: false }, { text: 'B. tables – computers', isCorrect: false }, { text: 'C. beds – chairs', isCorrect: false }, { text: 'D. tables – chairs', isCorrect: true } ],
                correctAnswer: 'D. tables – chairs',
                correctAnswer_vi: 'bàn và ghế',
                hint_vi: 'Nghe đoạn audio để biết hai loại đồ vật mới được nhắc đến là gì.',
                rationale_vi: 'Đoạn audio giới thiệu những cái "tables and chairs" (bàn và ghế) mới. Câu hoàn chỉnh được nghe là: "These are your new tables and chairs.".'
            },
            {
                type: 'fill-in-the-blank',
                question: '91. I’m fine, th__k you.',
                correctAnswer: 'an',
                correctAnswer_vi: 'an (để tạo thành "thank")',
                hint_vi: 'Từ này nằm trong cụm từ có nghĩa là "cảm ơn bạn".',
                rationale_vi: 'Từ đúng là "thank". Cụm từ là "thank you". Câu hoàn chỉnh: "I’m fine, thank you.".'
            },
            {
                type: 'fill-in-the-blank',
                question: '92. There are two books o_ the table.',
                correctAnswer: 'n',
                correctAnswer_vi: 'n (để tạo thành "on")',
                hint_vi: 'Giới từ này có nghĩa là "ở trên" một bề mặt.',
                rationale_vi: 'Giới từ "on" có nghĩa là "ở trên". Câu hoàn chỉnh: "There are two books on the table." nghĩa là "Có hai quyển sách ở trên bàn.".'
            },
            {
                type: 'rearrange',
                question: '93. Sắp xếp các từ sau:',
                words: ["on", "are there", "erasers", "How many", "the table?"],
                correctAnswer: "How many erasers are there on the table?",
                correctAnswer_vi: 'Có bao nhiêu cục tẩy trên bàn?',
                hint_vi: 'Đây là câu hỏi về số lượng, bắt đầu bằng "How many".',
                rationale_vi: 'Cấu trúc câu hỏi số lượng: How many + danh từ số nhiều (erasers) + are there + cụm từ chỉ nơi chốn (on the table)?. Câu hoàn chỉnh: "How many erasers are there on the table?".'
            },
            {
                type: 'multimedia',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206377131960084_Audio.mp3',
                question: '94. Listen and tick:',
                options: [ { text: 'A. My father is a teacher.', isCorrect: false }, { text: 'B. My mother is a teacher', isCorrect: false }, { text: 'C. My father is a doctor.', isCorrect: true }, { text: 'D. My brother is a teacher.', isCorrect: false } ],
                correctAnswer: 'C. My father is a doctor.',
                correctAnswer_vi: 'Bố tôi là một bác sĩ',
                hint_vi: 'Nghe kỹ đoạn audio để xác định ai làm nghề gì.',
                rationale_vi: 'Đoạn audio nói "C. My father is a doctor." có nghĩa là "Bố tôi là một bác sĩ.".'
            },
            {
                type: 'multimedia',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Audio/4-tn-60.mp3',
                question: '95. She wears a big ___ hat.',
                options: [ { text: 'A. black', isCorrect: false }, { text: 'B. blue', isCorrect: true }, { text: 'C. green', isCorrect: false }, { text: 'D. yellow', isCorrect: false } ],
                correctAnswer: 'B. blue',
                correctAnswer_vi: 'màu xanh',
                hint_vi: 'Nghe đoạn audio để biết màu sắc của chiếc mũ.',
                rationale_vi: 'Đoạn audio mô tả cô ấy đội một chiếc mũ lớn màu "blue" (xanh). Câu hoàn chỉnh được nghe là: "She wears a big blue hat.".'
            },
            {
                type: 'mc',
                question: '96. This isn’t ... bag.',
                options: [ { text: 'A. he', isCorrect: false }, { text: 'B. his', isCorrect: true }, { text: 'C. this', isCorrect: false }, { text: 'D. he’s', isCorrect: false } ],
                correctAnswer: 'B. his',
                correctAnswer_vi: 'của anh ấy',
                hint_vi: 'Từ nào dùng để chỉ cái túi này là "của anh ấy"?',
                rationale_vi: '"his" là tính từ sở hữu đứng trước danh từ "bag" để chỉ cái túi của một người nam. Câu hoàn chỉnh: "This isn’t his bag." nghĩa là "Đây không phải là túi của anh ấy.".'
            },
            {
                type: 'mc',
                question: '97. I’m fine, thank you. ... ?',
                options: [ { text: 'A. You', isCorrect: false }, { text: 'B. And you', isCorrect: true }, { text: 'C. Are you', isCorrect: false }, { text: 'D. Bye', isCorrect: false } ],
                correctAnswer: 'B. And you',
                correctAnswer_vi: 'Còn bạn thì sao?',
                hint_vi: 'Sau khi trả lời câu hỏi về sức khỏe, bạn nên hỏi lại người kia như thế nào?',
                rationale_vi: '"And you?" là cách lịch sự và thông thường để hỏi lại sau khi đã trả lời câu hỏi sức khỏe. Câu hoàn chỉnh: "I’m fine, thank you. And you?".'
            },
            {
                type: 'multimedia',
                mediaType: 'image',
                imagePrompt: 'A pink flower.',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2015/12/3/635847534640208109_566X320.jpg',
                question: '98. Look! That flower is ....',
                options: [ { text: 'A. pink', isCorrect: false }, { text: 'B. blue', isCorrect: true }, { text: 'C. green', isCorrect: false }, { text: 'D. black', isCorrect: false } ],
                correctAnswer: 'B. blue',
                correctAnswer_vi: 'màu xanh',
                hint_vi: 'Nhìn vào bức ảnh và xác định màu sắc của bông hoa.',
                rationale_vi: 'Bức ảnh cho thấy một bông hoa màu xanh ("blue"). Câu hoàn chỉnh: "Look! That flower is blue." có nghĩa là "Nhìn kìa! Bông hoa đó màu xanh.".'
            },
            {
                type: 'fill-in-the-blank',
                question: '99. How __ you spell your name?',
                correctAnswer: 'do',
                correctAnswer_vi: 'trợ động từ',
                hint_vi: 'Trong câu hỏi ở thì hiện tại đơn với chủ ngữ "you", ta dùng trợ động từ nào?',
                rationale_vi: 'Dùng trợ động từ "do" với chủ ngữ "you" trong câu hỏi thì hiện tại đơn. Câu hoàn chỉnh: "How do you spell your name?" nghĩa là "Bạn đánh vần tên của mình như thế nào?".'
            },
            {
                type: 'rearrange',
                question: '100. Sắp xếp các từ sau:',
                words: ["Raise", "your", "hands,", "please."],
                correctAnswer: "Raise your hands, please.",
                correctAnswer_vi: 'Làm ơn giơ tay lên.',
                hint_vi: 'Đây là một yêu cầu lịch sự trong lớp học, có nghĩa là "giơ tay lên".',
                rationale_vi: 'Cụm từ "Raise your hands" có nghĩa là "giơ tay của bạn lên". "please" thêm vào để tạo sự lịch sự. Câu hoàn chỉnh: "Raise your hands, please.".'
            }
        ];
        
        // --- Component: MediaDisplay ---
        const MediaDisplay = ({ question, showMessage }) => {
            if (question.mediaType === 'image') {
                return (
                    <div className="w-full p-4 bg-gray-100 rounded-xl mb-4 text-center border-2 border-dashed border-gray-300">
                        <p className="text-blue-600 font-bold mb-2">🖼️ Câu hỏi kèm Hình ảnh</p>
                        <img 
                            src={question.mediaSource}
                            alt={`Hình ảnh IOE: ${question.imagePrompt || 'Chủ đề câu hỏi'}`} 
                            className="w-full max-w-xs mx-auto rounded-lg shadow-md border-2 border-gray-300"
                            crossOrigin="anonymous"
                            referrerPolicy="no-referrer"
                            onError={(e) => { 
                                const target = e.target;
                                target.onerror = null; 
                                target.src = `https://placehold.co/566x320/ef4444/ffffff?text=L%E1%BB%97I+T%E1%BA%A2I+%E1%BA%A2NH+(CORS)`; 
                                showMessage('Lỗi tải ảnh: File media có thể bị chặn bởi trình duyệt.', 'error');
                            }}
                        />
                        <p className="text-xs text-gray-500 mt-2 break-all">Link gốc: {question.mediaSource}</p>
                        {question.imagePrompt && <p className="text-sm text-blue-600 mt-2 font-medium">Gợi ý nội dung: {question.imagePrompt}</p>}
                    </div>
                );
            }

            if (question.mediaType === 'audio') {
                return (
                    <div className="w-full p-4 bg-gray-100 rounded-xl mb-4 text-center border-2 border-dashed border-gray-300">
                        <p className="text-blue-600 font-bold mb-2">🔊 Câu hỏi Nghe (Bấm Play)</p>
                        <audio 
                            controls
                            src={question.mediaSource}
                            className="w-full max-w-sm mx-auto my-2"
                            crossOrigin="anonymous"
                            onError={() => {
                                showMessage('Lỗi tải Audio: File media có thể bị chặn.', 'error');
                            }}
                        >
                            <source src={question.mediaSource} type="audio/mp3" />
                            Trình duyệt của bạn không hỗ trợ phần tử audio.
                        </audio>
                        <p className="text-xs text-gray-500 mt-2 break-all">Link gốc: {question.mediaSource}</p>
                    </div>
                );
            }
            return null;
        }

        // --- Component: ProgressBar ---
        const ProgressBar = ({ percentage }) => {
            return (
                <div className="w-full h-2 bg-blue-100 rounded-full mt-4 overflow-hidden">
                    <div
                        className="h-full bg-blue-500 transition-all duration-500 ease-in-out"
                        style={{ width: `${percentage}%` }}
                    ></div>
                </div>
            );
        };
        
        // --- Component: MessageBox ---
        const MessageBox = ({ message, type }) => {
            const [visible, setVisible] = React.useState(false);

            React.useEffect(() => {
                if (message) {
                    setVisible(true);
                    const timer = setTimeout(() => {
                        setVisible(false);
                    }, 2700);
                    return () => clearTimeout(timer);
                } else {
                    setVisible(false);
                }
            }, [message, type]);

            const baseClasses = "fixed top-4 left-1/2 -translate-x-1/2 p-4 rounded-xl shadow-xl text-center font-bold text-lg z-50 transition-all duration-300 transform";
            
            const typeClasses = {
                success: 'bg-green-100 border border-green-500 text-green-800',
                error: 'bg-red-100 border border-red-500 text-red-800',
                info: 'bg-yellow-100 border border-yellow-500 text-yellow-800',
            };

            const visibilityClasses = visible ? 'opacity-100 scale-100' : 'opacity-0 scale-90 pointer-events-none';

            return (
                <div className={`${baseClasses} ${typeClasses[type]} ${visibilityClasses}`}>
                    {message}
                </div>
            );
        };
        
        // --- Component: RationaleBox ---
        const RationaleBox = ({ question, isCorrect, submittedAnswer }) => {
            const boxClasses = `mt-6 p-4 rounded-xl border transition duration-300 fade-in border-l-4 ${
                isCorrect ? 'bg-green-100 border-green-600' : 'bg-red-100 border-red-600'
            }`;
            
            const SubmittedAnswerDisplay = () => {
                const isFillIn = question.type === 'fill-in-the-blank' || (question.type === 'multimedia' && !question.options);
                
                if(isCorrect && !isFillIn) return null;
                
                return (
                    <>
                        <strong className="text-gray-700">
                           Bạn đã chọn/Điền:
                        </strong>
                        <span className="text-red-700 font-medium break-words"> {submittedAnswer}</span>
                        <br/>
                    </>
                );
            }

            return (
                <div className={boxClasses}>
                    <p className="font-bold text-lg mb-2 text-blue-700">Giải thích:</p>
                    <div className="text-gray-700 space-y-1">
                        {!isCorrect && <SubmittedAnswerDisplay />}
                        <p><strong>Đáp án đúng:</strong> <span className="text-green-800 font-semibold">{question.correctAnswer}</span></p>
                        
                        {question.correctAnswer_vi && (
                            <p><strong>Dịch nghĩa:</strong> <span className="text-green-600 font-medium">{question.correctAnswer_vi}</span></p>
                        )}
                        <p className="pt-2 border-t border-gray-300 mt-2">{question.rationale_vi || 'Không có giải thích chi tiết.'}</p>
                    </div>
                </div>
            );
        };

        // --- Component: FillInTheBlankQuestion ---
        const FillInTheBlankQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex }) => {
            const [inputValue, setInputValue] = React.useState('');
            const [isCorrectState, setIsCorrectState] = React.useState(null);
            const inputRef = React.useRef(null);

            React.useEffect(() => {
                setInputValue('');
                setIsCorrectState(null);
                if (inputRef.current && !isAnswered) {
                    inputRef.current.focus();
                }
            }, [question]);

            const handleSubmitClick = () => {
                const trimmedInput = inputValue.trim();
                if (trimmedInput === '') {
                    showMessage('Vui lòng điền câu trả lời của bạn!', 'info');
                    return;
                }
                const isCorrect = trimmedInput.toLowerCase() === question.correctAnswer.toLowerCase();
                setIsCorrectState(isCorrect);
                onSubmit(trimmedInput, isCorrect);
            };
            
            const questionTextParts = React.useMemo(() => {
                let text = question.question.replace(/^\d+\.\s*/, '');
                
                const markers = ['____', '________', '__________', '___________', '_________', '_______', '______', '_____', '___', '__', '_'];

                for (const marker of markers) {
                    if (text.includes(marker)) {
                        const parts = text.split(marker);
                        return [parts[0], parts.slice(1).join(marker)];
                    }
                }
                 
                const partialMatch = text.match(/(.*)__+(.*)/) || text.match(/(.*)\_+(.*)/);
                if (partialMatch) {
                    return [partialMatch[1], partialMatch[2]];
                }

                return [text, '']; 
            }, [question.question]);
            
            let inputClasses = 'inline-block mx-2 p-2 border-2 rounded-lg text-lg text-center shadow-sm transition duration-200 align-baseline w-48 font-mono';
            if (isAnswered) {
                inputClasses += isCorrectState ? ' border-green-500 bg-green-50 font-bold' : ' border-red-500 bg-red-50 font-bold';
            } else {
                inputClasses += ' border-gray-300 focus:border-blue-500';
            }

            const inputWidthStyle = {
                width: `${Math.max(8, question.correctAnswer.length * 1.5)}rem`, 
                maxWidth: '100%',
            };


            return (
                <div className="space-y-4">
                     {question.type === 'multimedia' && <MediaDisplay question={question} showMessage={showMessage} />}
                    <div className="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed text-center flex justify-center items-center flex-wrap">
                        <span className="mr-2">{questionIndex + 1}.</span>
                        {questionTextParts[0] && <span>{questionTextParts[0]}</span>}
                        <input
                            ref={inputRef}
                            type="text"
                            value={inputValue}
                            onChange={(e) => setInputValue(e.target.value)}
                            disabled={isAnswered}
                            placeholder={isAnswered ? question.correctAnswer : ""}
                            className={inputClasses}
                            style={inputWidthStyle}
                            onKeyPress={(e) => e.key === 'Enter' && !isAnswered && handleSubmitClick()}
                            aria-label="Fill in the blank"
                        />
                        {questionTextParts[1] && <span>{questionTextParts[1]}</span>}
                    </div>
                    <button
                        onClick={handleSubmitClick}
                        disabled={isAnswered}
                        className="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98"
                    >
                        Kiểm Tra
                    </button>
                </div>
            );
        };
        
        // --- Component: MultipleChoiceQuestion ---
        const MultipleChoiceQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex }) => {
            const [selectedIndex, setSelectedIndex] = React.useState(null);

            React.useEffect(() => {
                setSelectedIndex(null);
            }, [question]);

            const handleSubmitClick = () => {
                if (selectedIndex === null) {
                    showMessage('Vui lòng chọn một đáp án!', 'info');
                    return;
                }
                const selectedOption = question.options[selectedIndex];
                onSubmit(selectedOption.text, selectedOption.isCorrect);
            };
            
            const options = question.options || [];

            return (
                <>
                    {question.type === 'multimedia' && <MediaDisplay question={question} showMessage={showMessage} />}
                    
                    <h3
                        className="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed"
                        dangerouslySetInnerHTML={{ __html: `${questionIndex + 1}. ${question.question.replace(/^\d+\.\s*/, '')}` }}
                    />
                    <div className="space-y-4">
                        <div className="space-y-3">
                            {options.map((option, index) => {
                                const isSelected = selectedIndex === index;
                                let labelClasses = "block p-4 border-2 rounded-xl shadow-md text-lg transition duration-200";

                                if (isAnswered) {
                                    labelClasses += " cursor-default";
                                    if (option.isCorrect) {
                                        labelClasses += " bg-green-100 border-green-500 font-bold";
                                    } else if (isSelected) {
                                        labelClasses += " bg-red-100 border-red-500 font-bold";
                                    } else {
                                        labelClasses += " border-gray-200 opacity-60";
                                    }
                                } else {
                                    labelClasses += " cursor-pointer hover:bg-blue-50 hover:border-blue-300";
                                    if(isSelected) {
                                        labelClasses += " bg-blue-100 border-blue-500";
                                    } else {
                                        labelClasses += " border-gray-200";
                                    }
                                }

                                return (
                                    <div key={index} className="relative">
                                        <input
                                            type="radio"
                                            id={`option-${questionIndex}-${index}`}
                                            name={`mc-option-${questionIndex}`}
                                            value={index}
                                            className="hidden"
                                            checked={isSelected}
                                            onChange={() => setSelectedIndex(index)}
                                            disabled={isAnswered}
                                        />
                                        <label htmlFor={`option-${questionIndex}-${index}`} className={labelClasses} dangerouslySetInnerHTML={{ __html: option.text }}></label>
                                    </div>
                                );
                            })}
                        </div>
                        <button
                            onClick={handleSubmitClick}
                            disabled={isAnswered}
                            className="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98"
                        >
                            Kiểm Tra
                        </button>
                    </div>
                </>
            );
        };
        
        // --- Component: RearrangeQuestion ---
        const WordBlock = ({ word, onClick, isSource, isAnswered }) => {
            const baseClasses = 'word-block px-3 py-2 text-base sm:text-lg font-semibold rounded-lg shadow-sm transition-all duration-150 break-words transform active:scale-95';
            const sourceClasses = isSource ? 'bg-blue-100 text-blue-800 hover:bg-blue-200' : 'bg-gray-100 text-gray-800 border-b-2 border-gray-300';
            const disabledClasses = 'opacity-60 cursor-default shadow-inner';
            const interactiveClasses = 'cursor-pointer';

            return (
                <span
                    onClick={!isAnswered ? onClick : undefined}
                    className={`${baseClasses} ${sourceClasses} ${isAnswered ? disabledClasses : interactiveClasses}`}
                >
                    {word.text}
                </span>
            );
        };

        const RearrangeQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex, isCorrect }) => {
            const [sentenceWords, setSentenceWords] = React.useState([]);
            
            const initialSourceWords = React.useMemo(() => {
                return [...question.words]
                    .map((text) => ({ id: crypto.randomUUID(), text })) 
                    .sort(() => Math.random() - 0.5);
            }, [question]);

            const [sourceWords, setSourceWords] = React.useState(initialSourceWords);

            React.useEffect(() => {
                setSourceWords(initialSourceWords);
                setSentenceWords([]);
            }, [initialSourceWords]);

            const handleSelectWord = (word) => {
                setSourceWords(prev => prev.filter(w => w.id !== word.id));
                setSentenceWords(prev => [...prev, word]);
            };

            const handleReturnWord = (word) => {
                setSentenceWords(prev => prev.filter(w => w.id !== word.id));
                setSourceWords(prev => [...prev, word].sort((a, b) => initialSourceWords.findIndex(sw => sw.id === a.id) - initialSourceWords.findIndex(sw => sw.id === b.id)));
            };

            const handleSubmitClick = () => {
                if (sentenceWords.length === 0) {
                    showMessage('Vui lòng sắp xếp các từ!', 'info');
                    return;
                }
                
                const submitted = sentenceWords.map(w => w.text).join(' ').replace(/\s+([.,?!])/g, '$1').trim();
                const normalize = (str) => str.replace(/’/g, "'").replace(/[.,?!]/g, '').replace(/\s+/g, ' ').toLowerCase().trim();
                
                const isCorrectResult = normalize(submitted) === normalize(question.correctAnswer);
                onSubmit(submitted, isCorrectResult);
            };

            return (
                <>
                    <h3
                        className="text-xl sm:text-2xl font-semibold mb-6 leading-relaxed"
                        dangerouslySetInnerHTML={{ __html: `${questionIndex + 1}. ${question.question.replace(/^\d+\.\s*/, '')}` }}
                    />
                    <div className="space-y-4">
                        <div className={`min-h-[60px] p-3 border-2 rounded-xl shadow-inner flex flex-wrap gap-2 items-center transition duration-300 ${isAnswered ? (isCorrect ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50') : 'border-blue-300 bg-blue-50 border-dashed'}`}>
                            {sentenceWords.length === 0 && !isAnswered ? (
                                <span className="text-gray-500 italic text-sm">Chạm vào các từ bên dưới để xây dựng câu trả lời...</span>
                            ) : (
                                sentenceWords.map(word => (
                                    <WordBlock key={word.id} word={word} onClick={() => handleReturnWord(word)} isSource={false} isAnswered={isAnswered} />
                                ))
                            )}
                        </div>
                        
                        <div className="min-h-[100px] p-4 bg-gray-100 rounded-xl shadow-md flex flex-wrap gap-2 items-center border border-gray-200">
                            {sourceWords.map(word => (
                                <WordBlock key={word.id} word={word} onClick={() => handleSelectWord(word)} isSource={true} isAnswered={isAnswered} />
                            ))}
                        </div>
                        <button
                            onClick={handleSubmitClick}
                            disabled={isAnswered}
                            className="w-full py-2 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98"
                        >
                            Kiểm Tra
                        </button>
                    </div>
                </>
            );
        };
        
        // --- Component: StartScreen ---
        const StartScreen = ({ onStart, totalQuestions }) => {
            const [name, setName] = React.useState('');

            const handleStart = () => {
                if (name.trim()) {
                    onStart(name.trim());
                }
            };

            const isButtonDisabled = name.trim() === '';

            return (
                <div className="fade-in text-center p-4">
                    <header className="mb-8">
                        <h1 className="text-3xl sm:text-4xl font-extrabold text-blue-600 mb-2">BỘ ĐỀ ÔN IOE K3 SỐ: 02.1</h1>
                        <p className="text-lg text-gray-500">Bộ đề luyện thi IOE dành cho khối 3</p>
                    </header>
                    <div className="max-w-md mx-auto bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                        <h2 className="text-2xl font-semibold mb-4 text-gray-700">Chào mừng bạn!</h2>
                        <p className="text-gray-600 mb-6">Mỗi câu trả lời đúng được cộng 10 điểm. Bài thi có {totalQuestions} câu.</p>
                        <div className="space-y-4">
                            <label htmlFor="player-name" className="block text-sm font-medium text-gray-700 text-left">Nhập tên của bạn để bắt đầu:</label>
                            <input
                                type="text"
                                id="player-name"
                                placeholder="Tên người chơi"
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-lg shadow-sm transition duration-150"
                                maxLength={50}
                                value={name}
                                onChange={(e) => setName(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && !isButtonDisabled && handleStart()}
                            />
                            <button
                                onClick={handleStart}
                                disabled={isButtonDisabled}
                                className="w-full py-3 px-4 bg-blue-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-xl active:scale-98"
                            >
                                Bắt Đầu
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // --- Component: EndScreen ---
        const EndScreen = ({ playerName, score, totalQuestions, onRestart, onReview }) => {
            const maxScore = totalQuestions * 10;
            const percentage = maxScore > 0 ? (score / maxScore) * 100 : 0;
            
            let encouragement = "Cố gắng hơn ở lần sau nhé!";
            if (percentage >= 90) {
                encouragement = "Xuất sắc! Bạn thật sự là một chuyên gia!";
            } else if (percentage >= 70) {
                encouragement = "Làm tốt lắm! Chỉ cần cố gắng thêm một chút nữa thôi.";
            } else if (percentage >= 50) {
                encouragement = "Khá tốt! Hãy tiếp tục ôn luyện nhé.";
            }

            return (
                <div className="text-center fade-in p-4">
                    <h2 className="text-3xl font-bold mb-2 text-green-600">🎉 Hoàn Thành! 🎉</h2>
                    <p className="text-xl text-gray-700 mb-4">
                        Chúc mừng, <span className="font-extrabold text-blue-600">{playerName}</span>!
                    </p>
                     <p className="text-lg text-gray-600 mb-6">{encouragement}</p>
                    <div className="bg-white p-8 rounded-xl shadow-lg inline-block border border-gray-100">
                        <p className="text-2xl font-semibold mb-8 text-gray-700">Điểm số cuối cùng:</p>
                        <p className={`text-6xl font-black mb-10 text-blue-700`}>
                            {score} / {maxScore}
                        </p>
                    </div>
                    <div className="mt-8 flex flex-col sm:flex-row justify-center items-center gap-4">
                        {onReview && (
                             <button
                                onClick={onReview}
                                className="py-3 px-6 bg-yellow-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-yellow-600 text-lg active:scale-98"
                            >
                                Xem lại câu sai
                            </button>
                        )}
                        <button
                            onClick={onRestart}
                            className="py-3 px-6 bg-blue-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-blue-600 text-lg active:scale-98"
                        >
                            Làm lại bài thi
                        </button>
                    </div>
                </div>
            );
        };

        // --- Component: ReviewScreen ---
        const ReviewScreen = ({ incorrectAnswers, onBack }) => {
            return (
                <div className="fade-in">
                    <header className="text-center mb-8">
                        <h1 className="text-3xl sm:text-4xl font-extrabold text-yellow-600 mb-2">Ôn tập các câu sai</h1>
                    </header>
                    <div className="space-y-8">
                        {incorrectAnswers.map(({ question, submittedAnswer }, index) => (
                            <div key={index} className="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                                <h3 className="text-xl sm:text-2xl font-semibold mb-4 leading-relaxed"
                                    dangerouslySetInnerHTML={{ __html: `${index + 1}. ${question.question.replace(/^\d+\.\s*/, '')}` }}
                                />
                                {question.mediaType && <MediaDisplay question={question} showMessage={() => {}} />}
                                <RationaleBox question={question} isCorrect={false} submittedAnswer={submittedAnswer} />
                            </div>
                        ))}
                    </div>
                    <div className="mt-8 text-center">
                        <button
                            onClick={onBack}
                            className="py-3 px-6 bg-blue-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-blue-600 text-lg active:scale-98"
                        >
                            Quay lại màn hình điểm
                        </button>
                    </div>
                </div>
            );
        };
        
        // --- Component: QuizScreen ---
        const QuizScreen = ({ playerName, onEnd, totalQuestions, questionSet }) => {
            const [currentQuestionIndex, setCurrentQuestionIndex] = React.useState(0);
            const [score, setScore] = React.useState(0);
            const [isAnswered, setIsAnswered] = React.useState(false);
            const [isCorrect, setIsCorrect] = React.useState(false);
            const [submittedAnswer, setSubmittedAnswer] = React.useState('');
            const [isHintVisible, setIsHintVisible] = React.useState(false);
            const [message, setMessage] = React.useState(null);
            const incorrectAnswersRef = React.useRef([]);

            const currentQuestion = questionSet[currentQuestionIndex];

            React.useEffect(() => {
                incorrectAnswersRef.current = [];
            }, [questionSet]);

             React.useEffect(() => {
                setIsAnswered(false);
                setIsCorrect(false);
                setSubmittedAnswer('');
                setIsHintVisible(false);
                setMessage(null);
            }, [currentQuestionIndex]);
            
            const showMessage = (text, type) => {
                setMessage({ text, type });
            };

            const handleSubmit = (answer, isAnswerCorrect) => {
                if (isAnswered) return;
                
                setIsAnswered(true);
                setSubmittedAnswer(answer);
                setIsCorrect(isAnswerCorrect);

                if (isAnswerCorrect) {
                    setScore(prev => prev + 10);
                    showMessage('CHÍNH XÁC! +10 điểm', 'success');
                } else {
                    showMessage('SAI RỒI! Hãy xem lại nhé.', 'error');
                    incorrectAnswersRef.current.push({ question: currentQuestion, submittedAnswer: answer });
                }
            };

            const handleNext = () => {
                if (currentQuestionIndex < totalQuestions - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                } else {
                    onEnd(score, incorrectAnswersRef.current);
                }
            };

            if (!currentQuestion) {
                return <div className="text-center p-8">Đang tải câu hỏi...</div>;
            }

            const progressPercentage = ((currentQuestionIndex + 1) / totalQuestions) * 100;
            
            const renderQuestionComponent = () => {
                const commonProps = {
                    isAnswered,
                    onSubmit: handleSubmit,
                    showMessage,
                    questionIndex: currentQuestionIndex,
                };

                if (currentQuestion.type === 'rearrange') {
                    return <RearrangeQuestion {...commonProps} question={currentQuestion} isCorrect={isCorrect} />;
                }
                if (currentQuestion.type === 'mc' || (currentQuestion.type === 'multimedia' && currentQuestion.options)) {
                    return <MultipleChoiceQuestion {...commonProps} question={currentQuestion} />;
                }
                if (currentQuestion.type === 'fill-in-the-blank' || (currentQuestion.type === 'multimedia' && !currentQuestion.options)) {
                    return <FillInTheBlankQuestion {...commonProps} question={currentQuestion} />;
                }
                
                return <div className="text-red-500">Lỗi: Loại câu hỏi không xác định.</div>;
            };

            return (
                <div className="fade-in">
                    {message && <MessageBox message={message.text} type={message.type} />}
                    <header className="text-center mb-8">
                        <h1 className="text-3xl sm:text-4xl font-extrabold text-blue-600 mb-2">BỘ ĐỀ ÔN IOE K3 SỐ: 02</h1>
                        <ProgressBar percentage={progressPercentage} />
                    </header>

                    <div className="flex justify-between items-center mb-6 py-2 px-4 bg-blue-50 rounded-xl shadow-inner border border-blue-100">
                        <p className="text-sm sm:text-base font-medium text-blue-800">Người chơi: <span className="font-bold">{playerName}</span></p>
                        <p className="text-sm sm:text-base font-medium text-blue-800">Điểm: <span className="text-xl font-extrabold text-red-600">{score}</span></p>
                        <p className="text-sm sm:text-base font-medium text-blue-800">Câu: <span className="font-bold">{currentQuestionIndex + 1}/{totalQuestions}</span></p>
                    </div>

                    <div className="mb-8">
                        {renderQuestionComponent()}
                    </div>

                    <div className="mt-8 border-t pt-6 flex justify-between items-center flex-wrap gap-4">
                        <div className="relative">
                            <button
                                className="bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 hover:bg-yellow-600 active:scale-95"
                                onMouseEnter={() => setIsHintVisible(true)}
                                onMouseLeave={() => setIsHintVisible(false)}
                                onTouchStart={() => setIsHintVisible(true)}
                                onTouchEnd={() => setIsHintVisible(false)}
                            >
                                Gợi ý
                            </button>
                            <div className={`absolute bottom-full mb-2 w-max max-w-[90vw] sm:max-w-sm p-4 bg-yellow-100 border-l-4 border-yellow-500 rounded-xl shadow-lg transition-all duration-300 transform origin-bottom-left ${isHintVisible ? 'opacity-100 scale-100' : 'opacity-0 scale-90 pointer-events-none'}`}>
                                <p className="font-semibold text-yellow-800">Gợi ý:</p>
                                <p className="text-yellow-700">{currentQuestion.hint_vi || 'Không có gợi ý.'}</p>
                            </div>
                        </div>
                        
                        <button onClick={handleNext} disabled={!isAnswered} className="flex-grow py-3 px-4 bg-blue-500 text-white font-bold rounded-xl shadow-xl transition duration-300 hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98">
                            {currentQuestionIndex === totalQuestions - 1 ? 'Hoàn thành' : 'Câu tiếp theo'}
                        </button>
                    </div>

                    {isAnswered && (
                        <RationaleBox question={currentQuestion} isCorrect={isCorrect} submittedAnswer={submittedAnswer} />
                    )}
                </div>
            );
        };
        
        // --- Component: App ---
        const App = () => {
            const [gameState, setGameState] = React.useState('start');
            const [playerName, setPlayerName] = React.useState('');
            const [score, setScore] = React.useState(0);
            const [shuffledQuestions, setShuffledQuestions] = React.useState([]);
            const [incorrectAnswers, setIncorrectAnswers] = React.useState([]);

            const shuffleQuestions = () => {
                const array = [...questions];
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                setShuffledQuestions(array);
            };

            React.useEffect(() => {
                shuffleQuestions();
            }, []);

            const handleStartQuiz = (name) => {
                setPlayerName(name);
                setScore(0);
                setIncorrectAnswers([]);
                setGameState('quiz');
            };

            const handleEndQuiz = (finalScore, mistakes) => {
                setScore(finalScore);
                setIncorrectAnswers(mistakes);
                setGameState('end');
            };
            
            const handleRestartQuiz = () => {
                shuffleQuestions();
                setPlayerName('');
                setGameState('start');
            };

            const handleReview = () => {
                setGameState('review');
            };

             const handleBackToEndScreen = () => {
                setGameState('end');
            };

            const renderContent = () => {
                switch (gameState) {
                    case 'quiz':
                        return <QuizScreen 
                                    playerName={playerName} 
                                    onEnd={handleEndQuiz} 
                                    totalQuestions={shuffledQuestions.length}
                                    questionSet={shuffledQuestions}
                                />;
                    case 'end':
                        return <EndScreen 
                                    playerName={playerName} 
                                    score={score} 
                                    totalQuestions={shuffledQuestions.length}
                                    onRestart={handleRestartQuiz} 
                                    onReview={incorrectAnswers.length > 0 ? handleReview : null}
                                />;
                    case 'review':
                        return <ReviewScreen 
                                    incorrectAnswers={incorrectAnswers}
                                    onBack={handleBackToEndScreen}
                                />;
                    default:
                         return <StartScreen onStart={handleStartQuiz} totalQuestions={questions.length} />;
                }
            };

            return (
                <div className="p-4 sm:p-8 flex justify-center items-start min-h-screen">
                    <div className="w-full max-w-3xl bg-white rounded-xl shadow-2xl p-6 sm:p-8 md:p-10 border border-gray-100 min-h-[80vh]">
                        {renderContent()}
                    </div>
                </div>
            );
        };
        
        // --- Entry point ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>
